---
read_when:
  - è°ƒåº¦åŽå°ä»»åŠ¡æˆ–å”¤é†’
  - é…ç½®éœ€è¦ä¸Žå¿ƒè·³ä¸€èµ·æˆ–å¹¶è¡Œè¿è¡Œçš„è‡ªåŠ¨åŒ–
  - åœ¨å¿ƒè·³å’Œå®šæ—¶ä»»åŠ¡ä¹‹é—´åšé€‰æ‹©
summary: Gatewayç½‘å…³è°ƒåº¦å™¨çš„å®šæ—¶ä»»åŠ¡ä¸Žå”¤é†’
title: å®šæ—¶ä»»åŠ¡
x-i18n:
  generated_at: "2026-02-01T19:37:32Z"
  model: claude-opus-4-5
  provider: pi
  source_hash: d43268b0029f1b13d0825ddcc9c06a354987ea17ce02f3b5428a9c68bf936676
  source_path: automation/cron-jobs.md
  workflow: 14
---

# å®šæ—¶ä»»åŠ¡ï¼ˆGatewayç½‘å…³è°ƒåº¦å™¨ï¼‰

> **å®šæ—¶ä»»åŠ¡è¿˜æ˜¯å¿ƒè·³ï¼Ÿ** è¯·å‚é˜…[å®šæ—¶ä»»åŠ¡ä¸Žå¿ƒè·³å¯¹æ¯”](/automation/cron-vs-heartbeat)äº†è§£ä½•æ—¶ä½¿ç”¨å“ªç§æ–¹å¼ã€‚

å®šæ—¶ä»»åŠ¡æ˜¯ Gatewayç½‘å…³å†…ç½®çš„è°ƒåº¦å™¨ã€‚å®ƒæŒä¹…åŒ–ä»»åŠ¡ã€åœ¨åˆé€‚çš„æ—¶é—´å”¤é†’æ™ºèƒ½ä½“ï¼Œå¹¶å¯é€‰æ‹©å°†è¾“å‡ºå‘é€å›žèŠå¤©ã€‚

å¦‚æžœä½ æƒ³è¦ _"æ¯å¤©æ—©ä¸Šè¿è¡Œ"_ æˆ– _"20 åˆ†é’ŸåŽæé†’æ™ºèƒ½ä½“"_ï¼Œå®šæ—¶ä»»åŠ¡å°±æ˜¯å¯¹åº”çš„æœºåˆ¶ã€‚

## ç®€è¦æ¦‚è¿°

- å®šæ—¶ä»»åŠ¡è¿è¡Œåœ¨ **Gatewayç½‘å…³å†…éƒ¨**ï¼ˆè€Œéžæ¨¡åž‹å†…éƒ¨ï¼‰ã€‚
- ä»»åŠ¡æŒä¹…åŒ–å­˜å‚¨åœ¨ `~/.krabkrab/cron/` ä¸‹ï¼Œå› æ­¤é‡å¯ä¸ä¼šä¸¢å¤±è®¡åˆ’ã€‚
- ä¸¤ç§æ‰§è¡Œæ–¹å¼ï¼š
  - **ä¸»ä¼šè¯**ï¼šå…¥é˜Ÿä¸€ä¸ªç³»ç»Ÿäº‹ä»¶ï¼Œç„¶åŽåœ¨ä¸‹ä¸€æ¬¡å¿ƒè·³æ—¶è¿è¡Œã€‚
  - **éš”ç¦»å¼**ï¼šåœ¨ `cron:<jobId>` ä¸­è¿è¡Œä¸“ç”¨æ™ºèƒ½ä½“è½®æ¬¡ï¼Œå¯æŠ•é€’æ‘˜è¦ï¼ˆé»˜è®¤ announceï¼‰æˆ–ä¸æŠ•é€’ã€‚
- å”¤é†’æ˜¯ä¸€ç­‰åŠŸèƒ½ï¼šä»»åŠ¡å¯ä»¥è¯·æ±‚"ç«‹å³å”¤é†’"æˆ–"ä¸‹æ¬¡å¿ƒè·³æ—¶"ã€‚

## å¿«é€Ÿå¼€å§‹ï¼ˆå¯æ“ä½œï¼‰

åˆ›å»ºä¸€ä¸ªä¸€æ¬¡æ€§æé†’ï¼ŒéªŒè¯å…¶å­˜åœ¨ï¼Œç„¶åŽç«‹å³è¿è¡Œï¼š

```bash
krabkrab cron add \
  --name "Reminder" \
  --at "2026-02-01T16:00:00Z" \
  --session main \
  --system-event "Reminder: check the cron docs draft" \
  --wake now \
  --delete-after-run

krabkrab cron list
krabkrab cron run <job-id> --force
krabkrab cron runs --id <job-id>
```

è°ƒåº¦ä¸€ä¸ªå¸¦æŠ•é€’åŠŸèƒ½çš„å‘¨æœŸæ€§éš”ç¦»ä»»åŠ¡ï¼š

```bash
krabkrab cron add \
  --name "Morning brief" \
  --cron "0 7 * * *" \
  --tz "America/Los_Angeles" \
  --session isolated \
  --message "Summarize overnight updates." \
  --announce \
  --channel slack \
  --to "channel:C1234567890"
```

## å·¥å…·è°ƒç”¨ç­‰ä»·å½¢å¼ï¼ˆGatewayç½‘å…³å®šæ—¶ä»»åŠ¡å·¥å…·ï¼‰

æœ‰å…³è§„èŒƒçš„ JSON ç»“æž„å’Œç¤ºä¾‹ï¼Œè¯·å‚é˜…[å·¥å…·è°ƒç”¨çš„ JSON æ¨¡å¼](/automation/cron-jobs#json-schema-for-tool-calls)ã€‚

## å®šæ—¶ä»»åŠ¡çš„å­˜å‚¨ä½ç½®

å®šæ—¶ä»»åŠ¡é»˜è®¤æŒä¹…åŒ–å­˜å‚¨åœ¨ Gatewayç½‘å…³ä¸»æœºçš„ `~/.krabkrab/cron/jobs.json` ä¸­ã€‚Gatewayç½‘å…³å°†æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶åœ¨æ›´æ”¹æ—¶å†™å›žï¼Œå› æ­¤ä»…åœ¨ Gatewayç½‘å…³åœæ­¢æ—¶æ‰‹åŠ¨ç¼–è¾‘æ‰æ˜¯å®‰å…¨çš„ã€‚è¯·ä¼˜å…ˆä½¿ç”¨ `krabkrab cron add/edit` æˆ–å®šæ—¶ä»»åŠ¡å·¥å…·è°ƒç”¨ API è¿›è¡Œæ›´æ”¹ã€‚

## æ–°æ‰‹å‹å¥½æ¦‚è¿°

å°†å®šæ—¶ä»»åŠ¡ç†è§£ä¸ºï¼š**ä½•æ—¶**è¿è¡Œ + **åšä»€ä¹ˆ**ã€‚

1. **é€‰æ‹©è°ƒåº¦è®¡åˆ’**
   - ä¸€æ¬¡æ€§æé†’ â†’ `schedule.kind = "at"`ï¼ˆCLIï¼š`--at`ï¼‰
   - é‡å¤ä»»åŠ¡ â†’ `schedule.kind = "every"` æˆ– `schedule.kind = "cron"`
   - å¦‚æžœä½ çš„ ISO æ—¶é—´æˆ³çœç•¥äº†æ—¶åŒºï¼Œå°†è¢«è§†ä¸º **UTC**ã€‚

2. **é€‰æ‹©è¿è¡Œä½ç½®**
   - `sessionTarget: "main"` â†’ åœ¨ä¸‹ä¸€æ¬¡å¿ƒè·³æ—¶ä½¿ç”¨ä¸»ä¼šè¯ä¸Šä¸‹æ–‡è¿è¡Œã€‚
   - `sessionTarget: "isolated"` â†’ åœ¨ `cron:<jobId>` ä¸­è¿è¡Œä¸“ç”¨æ™ºèƒ½ä½“è½®æ¬¡ã€‚

3. **é€‰æ‹©è´Ÿè½½**
   - ä¸»ä¼šè¯ â†’ `payload.kind = "systemEvent"`
   - éš”ç¦»ä¼šè¯ â†’ `payload.kind = "agentTurn"`

å¯é€‰ï¼šä¸€æ¬¡æ€§ä»»åŠ¡ï¼ˆ`schedule.kind = "at"`ï¼‰é»˜è®¤ä¼šåœ¨æˆåŠŸè¿è¡ŒåŽåˆ é™¤ã€‚è®¾ç½®
`deleteAfterRun: false` å¯ä¿ç•™å®ƒï¼ˆæˆåŠŸåŽä¼šç¦ç”¨ï¼‰ã€‚

## æ¦‚å¿µ

### ä»»åŠ¡

å®šæ—¶ä»»åŠ¡æ˜¯ä¸€æ¡å­˜å‚¨è®°å½•ï¼ŒåŒ…å«ï¼š

- ä¸€ä¸ª**è°ƒåº¦è®¡åˆ’**ï¼ˆä½•æ—¶è¿è¡Œï¼‰ï¼Œ
- ä¸€ä¸ª**è´Ÿè½½**ï¼ˆåšä»€ä¹ˆï¼‰ï¼Œ
- å¯é€‰çš„**æŠ•é€’**ï¼ˆè¾“å‡ºå‘é€åˆ°å“ªé‡Œï¼‰ã€‚
- å¯é€‰çš„**æ™ºèƒ½ä½“ç»‘å®š**ï¼ˆ`agentId`ï¼‰ï¼šåœ¨æŒ‡å®šæ™ºèƒ½ä½“ä¸‹è¿è¡Œä»»åŠ¡ï¼›å¦‚æžœç¼ºå¤±æˆ–æœªçŸ¥ï¼ŒGatewayç½‘å…³ä¼šå›žé€€åˆ°é»˜è®¤æ™ºèƒ½ä½“ã€‚

ä»»åŠ¡é€šè¿‡ç¨³å®šçš„ `jobId` æ ‡è¯†ï¼ˆç”¨äºŽ CLI/Gatewayç½‘å…³ APIï¼‰ã€‚
åœ¨æ™ºèƒ½ä½“å·¥å…·è°ƒç”¨ä¸­ï¼Œ`jobId` æ˜¯è§„èŒƒå­—æ®µï¼›æ—§ç‰ˆ `id` ä»å¯å…¼å®¹ä½¿ç”¨ã€‚
ä¸€æ¬¡æ€§ä»»åŠ¡é»˜è®¤ä¼šåœ¨æˆåŠŸè¿è¡ŒåŽè‡ªåŠ¨åˆ é™¤ï¼›è®¾ç½® `deleteAfterRun: false` å¯ä¿ç•™å®ƒã€‚

### è°ƒåº¦è®¡åˆ’

å®šæ—¶ä»»åŠ¡æ”¯æŒä¸‰ç§è°ƒåº¦ç±»åž‹ï¼š

- `at`ï¼šä¸€æ¬¡æ€§æ—¶é—´æˆ³ï¼ˆISO 8601 å­—ç¬¦ä¸²ï¼‰ã€‚
- `every`ï¼šå›ºå®šé—´éš”ï¼ˆæ¯«ç§’ï¼‰ã€‚
- `cron`ï¼š5 å­—æ®µ cron è¡¨è¾¾å¼ï¼Œå¯é€‰ IANA æ—¶åŒºã€‚

Cron è¡¨è¾¾å¼ä½¿ç”¨ `croner`ã€‚å¦‚æžœçœç•¥æ—¶åŒºï¼Œå°†ä½¿ç”¨ Gatewayç½‘å…³ä¸»æœºçš„æœ¬åœ°æ—¶åŒºã€‚

### ä¸»ä¼šè¯ä¸Žéš”ç¦»å¼æ‰§è¡Œ

#### ä¸»ä¼šè¯ä»»åŠ¡ï¼ˆç³»ç»Ÿäº‹ä»¶ï¼‰

ä¸»ä¼šè¯ä»»åŠ¡å…¥é˜Ÿä¸€ä¸ªç³»ç»Ÿäº‹ä»¶ï¼Œå¹¶å¯é€‰æ‹©å”¤é†’å¿ƒè·³è¿è¡Œå™¨ã€‚å®ƒä»¬å¿…é¡»ä½¿ç”¨ `payload.kind = "systemEvent"`ã€‚

- `wakeMode: "next-heartbeat"`ï¼ˆé»˜è®¤ï¼‰ï¼šäº‹ä»¶ç­‰å¾…ä¸‹ä¸€æ¬¡è®¡åˆ’å¿ƒè·³ã€‚
- `wakeMode: "now"`ï¼šäº‹ä»¶è§¦å‘ç«‹å³å¿ƒè·³è¿è¡Œã€‚

å½“ä½ éœ€è¦æ­£å¸¸çš„å¿ƒè·³æç¤º + ä¸»ä¼šè¯ä¸Šä¸‹æ–‡æ—¶ï¼Œè¿™æ˜¯æœ€ä½³é€‰æ‹©ã€‚å‚è§[å¿ƒè·³](/gateway/heartbeat)ã€‚

#### éš”ç¦»ä»»åŠ¡ï¼ˆä¸“ç”¨å®šæ—¶ä¼šè¯ï¼‰

éš”ç¦»ä»»åŠ¡åœ¨ä¼šè¯ `cron:<jobId>` ä¸­è¿è¡Œä¸“ç”¨æ™ºèƒ½ä½“è½®æ¬¡ã€‚

å…³é”®è¡Œä¸ºï¼š

- æç¤ºä»¥ `[cron:<jobId> <ä»»åŠ¡åç§°>]` ä¸ºå‰ç¼€ï¼Œä¾¿äºŽè¿½è¸ªã€‚
- æ¯æ¬¡è¿è¡Œéƒ½ä¼šå¯åŠ¨ä¸€ä¸ª**å…¨æ–°çš„ä¼šè¯ ID**ï¼ˆä¸ç»§æ‰¿ä¹‹å‰çš„å¯¹è¯ï¼‰ã€‚
- å¦‚æžœæœªæŒ‡å®š `delivery`ï¼Œéš”ç¦»ä»»åŠ¡ä¼šé»˜è®¤ä»¥â€œannounceâ€æ–¹å¼æŠ•é€’æ‘˜è¦ã€‚
- `delivery.mode` å¯é€‰ `announce`ï¼ˆæŠ•é€’æ‘˜è¦ï¼‰æˆ– `none`ï¼ˆå†…éƒ¨è¿è¡Œï¼‰ã€‚

å¯¹äºŽå˜ˆæ‚ã€é¢‘ç¹æˆ–"åŽå°æ‚åŠ¡"ç±»ä»»åŠ¡ï¼Œä½¿ç”¨éš”ç¦»ä»»åŠ¡å¯ä»¥é¿å…æ±¡æŸ“ä½ çš„ä¸»èŠå¤©è®°å½•ã€‚

### è´Ÿè½½ç»“æž„ï¼ˆè¿è¡Œå†…å®¹ï¼‰

æ”¯æŒä¸¤ç§è´Ÿè½½ç±»åž‹ï¼š

- `systemEvent`ï¼šä»…é™ä¸»ä¼šè¯ï¼Œé€šè¿‡å¿ƒè·³æç¤ºè·¯ç”±ã€‚
- `agentTurn`ï¼šä»…é™éš”ç¦»ä¼šè¯ï¼Œè¿è¡Œä¸“ç”¨æ™ºèƒ½ä½“è½®æ¬¡ã€‚

å¸¸ç”¨ `agentTurn` å­—æ®µï¼š

- `message`ï¼šå¿…å¡«æ–‡æœ¬æç¤ºã€‚
- `model` / `thinking`ï¼šå¯é€‰è¦†ç›–ï¼ˆè§ä¸‹æ–‡ï¼‰ã€‚
- `timeoutSeconds`ï¼šå¯é€‰è¶…æ—¶è¦†ç›–ã€‚

### æ¨¡åž‹å’Œæ€ç»´è¦†ç›–

éš”ç¦»ä»»åŠ¡ï¼ˆ`agentTurn`ï¼‰å¯ä»¥è¦†ç›–æ¨¡åž‹å’Œæ€ç»´çº§åˆ«ï¼š

- `model`ï¼šæä¾›å•†/æ¨¡åž‹å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚ `anthropic/claude-sonnet-4-20250514`ï¼‰æˆ–åˆ«åï¼ˆä¾‹å¦‚ `opus`ï¼‰
- `thinking`ï¼šæ€ç»´çº§åˆ«ï¼ˆ`off`ã€`minimal`ã€`low`ã€`medium`ã€`high`ã€`xhigh`ï¼›ä»…é™ GPT-5.2 + Codex æ¨¡åž‹ï¼‰

æ³¨æ„ï¼šä½ ä¹Ÿå¯ä»¥åœ¨ä¸»ä¼šè¯ä»»åŠ¡ä¸Šè®¾ç½® `model`ï¼Œä½†è¿™ä¼šæ›´æ”¹å…±äº«çš„ä¸»ä¼šè¯æ¨¡åž‹ã€‚æˆ‘ä»¬å»ºè®®ä»…å¯¹éš”ç¦»ä»»åŠ¡ä½¿ç”¨æ¨¡åž‹è¦†ç›–ï¼Œä»¥é¿å…æ„å¤–çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚

ä¼˜å…ˆçº§è§£æžé¡ºåºï¼š

1. ä»»åŠ¡è´Ÿè½½è¦†ç›–ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
2. é’©å­ç‰¹å®šé»˜è®¤å€¼ï¼ˆä¾‹å¦‚ `hooks.gmail.model`ï¼‰
3. æ™ºèƒ½ä½“é…ç½®é»˜è®¤å€¼

### æŠ•é€’ï¼ˆæ¸ é“ + ç›®æ ‡ï¼‰

éš”ç¦»ä»»åŠ¡å¯ä»¥é€šè¿‡é¡¶å±‚ `delivery` é…ç½®æŠ•é€’è¾“å‡ºï¼š

- `delivery.mode`ï¼š`announce`ï¼ˆæŠ•é€’æ‘˜è¦ï¼‰æˆ– `none`
- `delivery.channel`ï¼š`whatsapp` / `telegram` / `discord` / `slack` / `mattermost`ï¼ˆæ’ä»¶ï¼‰/ `signal` / `imessage` / `last`
- `delivery.to`ï¼šæ¸ é“ç‰¹å®šçš„æŽ¥æ”¶ç›®æ ‡
- `delivery.bestEffort`ï¼šæŠ•é€’å¤±è´¥æ—¶é¿å…ä»»åŠ¡å¤±è´¥

å½“å¯ç”¨ announce æŠ•é€’æ—¶ï¼Œè¯¥è½®æ¬¡ä¼šæŠ‘åˆ¶æ¶ˆæ¯å·¥å…·å‘é€ï¼›è¯·ä½¿ç”¨ `delivery.channel`/`delivery.to` æ¥æŒ‡å®šç›®æ ‡ã€‚

å¦‚æžœçœç•¥ `delivery.channel` æˆ– `delivery.to`ï¼Œå®šæ—¶ä»»åŠ¡ä¼šå›žé€€åˆ°ä¸»ä¼šè¯çš„â€œæœ€åŽè·¯ç”±â€ï¼ˆæ™ºèƒ½ä½“æœ€åŽå›žå¤çš„ä½ç½®ï¼‰ã€‚

ç›®æ ‡æ ¼å¼æé†’ï¼š

- Slack/Discord/Mattermostï¼ˆæ’ä»¶ï¼‰ç›®æ ‡åº”ä½¿ç”¨æ˜Žç¡®å‰ç¼€ï¼ˆä¾‹å¦‚ `channel:<id>`ã€`user:<id>`ï¼‰ä»¥é¿å…æ­§ä¹‰ã€‚
- Telegram ä¸»é¢˜åº”ä½¿ç”¨ `:topic:` æ ¼å¼ï¼ˆè§ä¸‹æ–‡ï¼‰ã€‚

#### Telegram æŠ•é€’ç›®æ ‡ï¼ˆä¸»é¢˜/è®ºå›å¸–å­ï¼‰

Telegram é€šè¿‡ `message_thread_id` æ”¯æŒè®ºå›ä¸»é¢˜ã€‚å¯¹äºŽå®šæ—¶ä»»åŠ¡æŠ•é€’ï¼Œä½ å¯ä»¥å°†ä¸»é¢˜/å¸–å­ç¼–ç åˆ° `to` å­—æ®µä¸­ï¼š

- `-1001234567890`ï¼ˆä»…èŠå¤© IDï¼‰
- `-1001234567890:topic:123`ï¼ˆæŽ¨èï¼šæ˜Žç¡®çš„ä¸»é¢˜æ ‡è®°ï¼‰
- `-1001234567890:123`ï¼ˆç®€å†™ï¼šæ•°å­—åŽç¼€ï¼‰

å¸¦å‰ç¼€çš„ç›®æ ‡å¦‚ `telegram:...` / `telegram:group:...` ä¹Ÿå¯æŽ¥å—ï¼š

- `telegram:group:-1001234567890:topic:123`

## å·¥å…·è°ƒç”¨çš„ JSON æ¨¡å¼

ç›´æŽ¥è°ƒç”¨ Gatewayç½‘å…³ `cron.*` å·¥å…·ï¼ˆæ™ºèƒ½ä½“å·¥å…·è°ƒç”¨æˆ– RPCï¼‰æ—¶ä½¿ç”¨è¿™äº›ç»“æž„ã€‚CLI æ ‡å¿—æŽ¥å—äººç±»å¯è¯»çš„æ—¶é—´æ ¼å¼å¦‚ `20m`ï¼Œä½†å·¥å…·è°ƒç”¨åº”ä½¿ç”¨ ISO 8601 å­—ç¬¦ä¸²ä½œä¸º `schedule.at`ï¼Œå¹¶ä½¿ç”¨æ¯«ç§’ä½œä¸º `schedule.everyMs`ã€‚

### cron.add å‚æ•°

ä¸€æ¬¡æ€§ä¸»ä¼šè¯ä»»åŠ¡ï¼ˆç³»ç»Ÿäº‹ä»¶ï¼‰ï¼š

```json
{
  "name": "Reminder",
  "schedule": { "kind": "at", "at": "2026-02-01T16:00:00Z" },
  "sessionTarget": "main",
  "wakeMode": "now",
  "payload": { "kind": "systemEvent", "text": "Reminder text" },
  "deleteAfterRun": true
}
```

å¸¦æŠ•é€’çš„å‘¨æœŸæ€§éš”ç¦»ä»»åŠ¡ï¼š

```json
{
  "name": "Morning brief",
  "schedule": { "kind": "cron", "expr": "0 7 * * *", "tz": "America/Los_Angeles" },
  "sessionTarget": "isolated",
  "wakeMode": "next-heartbeat",
  "payload": {
    "kind": "agentTurn",
    "message": "Summarize overnight updates."
  },
  "delivery": {
    "mode": "announce",
    "channel": "slack",
    "to": "channel:C1234567890",
    "bestEffort": true
  }
}
```

è¯´æ˜Žï¼š

- `schedule.kind`ï¼š`at`ï¼ˆ`at`ï¼‰ã€`every`ï¼ˆ`everyMs`ï¼‰æˆ– `cron`ï¼ˆ`expr`ï¼Œå¯é€‰ `tz`ï¼‰ã€‚
- `schedule.at` æŽ¥å— ISO 8601ï¼ˆå¯çœç•¥æ—¶åŒºï¼›çœç•¥æ—¶æŒ‰ UTC å¤„ç†ï¼‰ã€‚
- `everyMs` ä¸ºæ¯«ç§’æ•°ã€‚
- `sessionTarget` å¿…é¡»ä¸º `"main"` æˆ– `"isolated"`ï¼Œä¸”å¿…é¡»ä¸Ž `payload.kind` åŒ¹é…ã€‚
- å¯é€‰å­—æ®µï¼š`agentId`ã€`description`ã€`enabled`ã€`deleteAfterRun`ã€`delivery`ã€‚
- `wakeMode` çœç•¥æ—¶é»˜è®¤ä¸º `"next-heartbeat"`ã€‚

### cron.update å‚æ•°

```json
{
  "jobId": "job-123",
  "patch": {
    "enabled": false,
    "schedule": { "kind": "every", "everyMs": 3600000 }
  }
}
```

è¯´æ˜Žï¼š

- `jobId` æ˜¯è§„èŒƒå­—æ®µï¼›`id` å¯å…¼å®¹ä½¿ç”¨ã€‚
- åœ¨è¡¥ä¸ä¸­ä½¿ç”¨ `agentId: null` å¯æ¸…é™¤æ™ºèƒ½ä½“ç»‘å®šã€‚

### cron.run å’Œ cron.remove å‚æ•°

```json
{ "jobId": "job-123", "mode": "force" }
```

```json
{ "jobId": "job-123" }
```

## å­˜å‚¨ä¸ŽåŽ†å²

- ä»»åŠ¡å­˜å‚¨ï¼š`~/.krabkrab/cron/jobs.json`ï¼ˆGatewayç½‘å…³ç®¡ç†çš„ JSONï¼‰ã€‚
- è¿è¡ŒåŽ†å²ï¼š`~/.krabkrab/cron/runs/<jobId>.jsonl`ï¼ˆJSONLï¼Œè‡ªåŠ¨æ¸…ç†ï¼‰ã€‚
- è¦†ç›–å­˜å‚¨è·¯å¾„ï¼šé…ç½®ä¸­çš„ `cron.store`ã€‚

## é…ç½®

```json5
{
  cron: {
    enabled: true, // é»˜è®¤ true
    store: "~/.krabkrab/cron/jobs.json",
    maxConcurrentRuns: 1, // é»˜è®¤ 1
  },
}
```

å®Œå…¨ç¦ç”¨å®šæ—¶ä»»åŠ¡ï¼š

- `cron.enabled: false`ï¼ˆé…ç½®ï¼‰
- `krabkrab_SKIP_CRON=1`ï¼ˆçŽ¯å¢ƒå˜é‡ï¼‰

## CLI å¿«é€Ÿå¼€å§‹

ä¸€æ¬¡æ€§æé†’ï¼ˆUTC ISOï¼ŒæˆåŠŸåŽè‡ªåŠ¨åˆ é™¤ï¼‰ï¼š

```bash
krabkrab cron add \
  --name "Send reminder" \
  --at "2026-01-12T18:00:00Z" \
  --session main \
  --system-event "Reminder: submit expense report." \
  --wake now \
  --delete-after-run
```

ä¸€æ¬¡æ€§æé†’ï¼ˆä¸»ä¼šè¯ï¼Œç«‹å³å”¤é†’ï¼‰ï¼š

```bash
krabkrab cron add \
  --name "Calendar check" \
  --at "20m" \
  --session main \
  --system-event "Next heartbeat: check calendar." \
  --wake now
```

å‘¨æœŸæ€§éš”ç¦»ä»»åŠ¡ï¼ˆæŠ•é€’åˆ° WhatsAppï¼‰ï¼š

```bash
krabkrab cron add \
  --name "Morning status" \
  --cron "0 7 * * *" \
  --tz "America/Los_Angeles" \
  --session isolated \
  --message "Summarize inbox + calendar for today." \
  --announce \
  --channel whatsapp \
  --to "+15551234567"
```

å‘¨æœŸæ€§éš”ç¦»ä»»åŠ¡ï¼ˆæŠ•é€’åˆ° Telegram ä¸»é¢˜ï¼‰ï¼š

```bash
krabkrab cron add \
  --name "Nightly summary (topic)" \
  --cron "0 22 * * *" \
  --tz "America/Los_Angeles" \
  --session isolated \
  --message "Summarize today; send to the nightly topic." \
  --announce \
  --channel telegram \
  --to "-1001234567890:topic:123"
```

å¸¦æ¨¡åž‹å’Œæ€ç»´è¦†ç›–çš„éš”ç¦»ä»»åŠ¡ï¼š

```bash
krabkrab cron add \
  --name "Deep analysis" \
  --cron "0 6 * * 1" \
  --tz "America/Los_Angeles" \
  --session isolated \
  --message "Weekly deep analysis of project progress." \
  --model "opus" \
  --thinking high \
  --announce \
  --channel whatsapp \
  --to "+15551234567"
```

æ™ºèƒ½ä½“é€‰æ‹©ï¼ˆå¤šæ™ºèƒ½ä½“é…ç½®ï¼‰ï¼š

```bash
# å°†ä»»åŠ¡ç»‘å®šåˆ°æ™ºèƒ½ä½“ "ops"ï¼ˆå¦‚æžœè¯¥æ™ºèƒ½ä½“ä¸å­˜åœ¨åˆ™å›žé€€åˆ°é»˜è®¤æ™ºèƒ½ä½“ï¼‰
krabkrab cron add --name "Ops sweep" --cron "0 6 * * *" --session isolated --message "Check ops queue" --agent ops

# åˆ‡æ¢æˆ–æ¸…é™¤çŽ°æœ‰ä»»åŠ¡çš„æ™ºèƒ½ä½“
krabkrab cron edit <jobId> --agent ops
krabkrab cron edit <jobId> --clear-agent
```

æ‰‹åŠ¨è¿è¡Œï¼ˆè°ƒè¯•ï¼‰ï¼š

```bash
krabkrab cron run <jobId> --force
```

ç¼–è¾‘çŽ°æœ‰ä»»åŠ¡ï¼ˆè¡¥ä¸å­—æ®µï¼‰ï¼š

```bash
krabkrab cron edit <jobId> \
  --message "Updated prompt" \
  --model "opus" \
  --thinking low
```

è¿è¡ŒåŽ†å²ï¼š

```bash
krabkrab cron runs --id <jobId> --limit 50
```

ä¸åˆ›å»ºä»»åŠ¡ç›´æŽ¥å‘é€ç³»ç»Ÿäº‹ä»¶ï¼š

```bash
krabkrab system event --mode now --text "Next heartbeat: check battery."
```

## Gatewayç½‘å…³ API æŽ¥å£

- `cron.list`ã€`cron.status`ã€`cron.add`ã€`cron.update`ã€`cron.remove`
- `cron.run`ï¼ˆå¼ºåˆ¶æˆ–åˆ°æœŸï¼‰ã€`cron.runs`
  å¦‚éœ€ä¸åˆ›å»ºä»»åŠ¡ç›´æŽ¥å‘é€ç³»ç»Ÿäº‹ä»¶ï¼Œè¯·ä½¿ç”¨ [`krabkrab system event`](/cli/system)ã€‚

## æ•…éšœæŽ’é™¤

### "æ²¡æœ‰ä»»ä½•ä»»åŠ¡è¿è¡Œ"

- æ£€æŸ¥å®šæ—¶ä»»åŠ¡æ˜¯å¦å·²å¯ç”¨ï¼š`cron.enabled` å’Œ `krabkrab_SKIP_CRON`ã€‚
- æ£€æŸ¥ Gatewayç½‘å…³æ˜¯å¦æŒç»­è¿è¡Œï¼ˆå®šæ—¶ä»»åŠ¡è¿è¡Œåœ¨ Gatewayç½‘å…³è¿›ç¨‹å†…éƒ¨ï¼‰ã€‚
- å¯¹äºŽ `cron` è°ƒåº¦ï¼šç¡®è®¤æ—¶åŒºï¼ˆ`--tz`ï¼‰ä¸Žä¸»æœºæ—¶åŒºçš„å…³ç³»ã€‚

### Telegram æŠ•é€’åˆ°äº†é”™è¯¯çš„ä½ç½®

- å¯¹äºŽè®ºå›ä¸»é¢˜ï¼Œä½¿ç”¨ `-100â€¦:topic:<id>` ä»¥ç¡®ä¿æ˜Žç¡®æ— æ­§ä¹‰ã€‚
- å¦‚æžœä½ åœ¨æ—¥å¿—æˆ–å­˜å‚¨çš„"æœ€åŽè·¯ç”±"ç›®æ ‡ä¸­çœ‹åˆ° `telegram:...` å‰ç¼€ï¼Œè¿™æ˜¯æ­£å¸¸çš„ï¼›å®šæ—¶ä»»åŠ¡æŠ•é€’æŽ¥å—è¿™äº›å‰ç¼€å¹¶ä»èƒ½æ­£ç¡®è§£æžä¸»é¢˜ IDã€‚

