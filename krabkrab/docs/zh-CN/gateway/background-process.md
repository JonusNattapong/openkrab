---
read_when:
  - æ·»åŠ æˆ–ä¿®æ”¹åŽå° exec è¡Œä¸º
  - è°ƒè¯•é•¿æ—¶é—´è¿è¡Œçš„ exec ä»»åŠ¡
summary: åŽå° exec æ‰§è¡Œå’Œè¿›ç¨‹ç®¡ç†
title: åŽå° Exec å’Œ Process å·¥å…·
x-i18n:
  generated_at: "2026-02-03T10:05:51Z"
  model: claude-opus-4-5
  provider: pi
  source_hash: e11a7d74a75000d6882f703693c2c49a2ecd3e730b6ec2b475ac402abde9e465
  source_path: gateway/background-process.md
  workflow: 15
---

# åŽå° Exec + Process å·¥å…·

KrabKrab é€šè¿‡ `exec` å·¥å…·è¿è¡Œ shell å‘½ä»¤ï¼Œå¹¶å°†é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚`process` å·¥å…·ç®¡ç†è¿™äº›åŽå°ä¼šè¯ã€‚

## exec å·¥å…·

å…³é”®å‚æ•°ï¼š

- `command`ï¼ˆå¿…å¡«ï¼‰
- `yieldMs`ï¼ˆé»˜è®¤ 10000ï¼‰ï¼šåœ¨æ­¤å»¶è¿ŸåŽè‡ªåŠ¨è½¬ä¸ºåŽå°è¿è¡Œ
- `background`ï¼ˆå¸ƒå°”å€¼ï¼‰ï¼šç«‹å³è½¬ä¸ºåŽå°è¿è¡Œ
- `timeout`ï¼ˆç§’ï¼Œé»˜è®¤ 1800ï¼‰ï¼šåœ¨æ­¤è¶…æ—¶åŽç»ˆæ­¢è¿›ç¨‹
- `elevated`ï¼ˆå¸ƒå°”å€¼ï¼‰ï¼šå¦‚æžœå¯ç”¨/å…è®¸ææƒæ¨¡å¼ï¼Œåˆ™åœ¨å®¿ä¸»æœºä¸Šè¿è¡Œ
- éœ€è¦çœŸå®ž TTYï¼Ÿè®¾ç½® `pty: true`ã€‚
- `workdir`ã€`env`

è¡Œä¸ºï¼š

- å‰å°è¿è¡Œç›´æŽ¥è¿”å›žè¾“å‡ºã€‚
- å½“è½¬ä¸ºåŽå°è¿è¡Œï¼ˆæ˜¾å¼æˆ–è¶…æ—¶ï¼‰æ—¶ï¼Œå·¥å…·è¿”å›ž `status: "running"` + `sessionId` å’Œä¸€å°æ®µå°¾éƒ¨è¾“å‡ºã€‚
- è¾“å‡ºä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œç›´åˆ°ä¼šè¯è¢«è½®è¯¢æˆ–æ¸…é™¤ã€‚
- å¦‚æžœ `process` å·¥å…·è¢«ç¦ç”¨ï¼Œ`exec` å°†åŒæ­¥è¿è¡Œå¹¶å¿½ç•¥ `yieldMs`/`background`ã€‚

## å­è¿›ç¨‹æ¡¥æŽ¥

å½“åœ¨ exec/process å·¥å…·ä¹‹å¤–ç”Ÿæˆé•¿æ—¶é—´è¿è¡Œçš„å­è¿›ç¨‹æ—¶ï¼ˆä¾‹å¦‚ CLI é‡æ–°ç”Ÿæˆæˆ– Gateway ç½‘å…³è¾…åŠ©ç¨‹åºï¼‰ï¼Œè¯·é™„åŠ å­è¿›ç¨‹æ¡¥æŽ¥è¾…åŠ©ç¨‹åºï¼Œä»¥ä¾¿ç»ˆæ­¢ä¿¡å·è¢«è½¬å‘ï¼Œç›‘å¬å™¨åœ¨é€€å‡º/é”™è¯¯æ—¶è¢«åˆ†ç¦»ã€‚è¿™å¯ä»¥é¿å…åœ¨ systemd ä¸Šäº§ç”Ÿå­¤ç«‹è¿›ç¨‹ï¼Œå¹¶ä¿æŒè·¨å¹³å°çš„å…³é—­è¡Œä¸ºä¸€è‡´ã€‚

çŽ¯å¢ƒå˜é‡è¦†ç›–ï¼š

- `PI_BASH_YIELD_MS`ï¼šé»˜è®¤ yield æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
- `PI_BASH_MAX_OUTPUT_CHARS`ï¼šå†…å­˜è¾“å‡ºä¸Šé™ï¼ˆå­—ç¬¦ï¼‰
- `krabkrab_BASH_PENDING_MAX_OUTPUT_CHARS`ï¼šæ¯ä¸ªæµçš„å¾…å¤„ç† stdout/stderr ä¸Šé™ï¼ˆå­—ç¬¦ï¼‰
- `PI_BASH_JOB_TTL_MS`ï¼šå·²å®Œæˆä¼šè¯çš„ TTLï¼ˆæ¯«ç§’ï¼Œé™åˆ¶åœ¨ 1 åˆ†é’Ÿè‡³ 3 å°æ—¶ä¹‹é—´ï¼‰

é…ç½®ï¼ˆæŽ¨èï¼‰ï¼š

- `tools.exec.backgroundMs`ï¼ˆé»˜è®¤ 10000ï¼‰
- `tools.exec.timeoutSec`ï¼ˆé»˜è®¤ 1800ï¼‰
- `tools.exec.cleanupMs`ï¼ˆé»˜è®¤ 1800000ï¼‰
- `tools.exec.notifyOnExit`ï¼ˆé»˜è®¤ trueï¼‰ï¼šå½“åŽå° exec é€€å‡ºæ—¶ï¼Œå°†ç³»ç»Ÿäº‹ä»¶åŠ å…¥é˜Ÿåˆ—å¹¶è¯·æ±‚å¿ƒè·³ã€‚

## process å·¥å…·

æ“ä½œï¼š

- `list`ï¼šæ­£åœ¨è¿è¡Œå’Œå·²å®Œæˆçš„ä¼šè¯
- `poll`ï¼šèŽ·å–ä¼šè¯çš„æ–°è¾“å‡ºï¼ˆåŒæ—¶æŠ¥å‘Šé€€å‡ºçŠ¶æ€ï¼‰
- `log`ï¼šè¯»å–èšåˆè¾“å‡ºï¼ˆæ”¯æŒ `offset` + `limit`ï¼‰
- `write`ï¼šå‘é€ stdinï¼ˆ`data`ï¼Œå¯é€‰ `eof`ï¼‰
- `kill`ï¼šç»ˆæ­¢åŽå°ä¼šè¯
- `clear`ï¼šä»Žå†…å­˜ä¸­ç§»é™¤å·²å®Œæˆçš„ä¼šè¯
- `remove`ï¼šå¦‚æžœæ­£åœ¨è¿è¡Œåˆ™ç»ˆæ­¢ï¼Œå¦åˆ™æ¸…é™¤å·²å®Œæˆçš„ä¼šè¯

æ³¨æ„äº‹é¡¹ï¼š

- åªæœ‰åŽå°ä¼šè¯ä¼šåœ¨å†…å­˜ä¸­åˆ—å‡º/ä¿ç•™ã€‚
- ä¼šè¯åœ¨è¿›ç¨‹é‡å¯æ—¶ä¼šä¸¢å¤±ï¼ˆæ— ç£ç›˜æŒä¹…åŒ–ï¼‰ã€‚
- ä¼šè¯æ—¥å¿—åªæœ‰åœ¨ä½ è¿è¡Œ `process poll/log` ä¸”å·¥å…·ç»“æžœè¢«è®°å½•æ—¶æ‰ä¼šä¿å­˜åˆ°èŠå¤©åŽ†å²ã€‚
- `process` æŒ‰æ™ºèƒ½ä½“éš”ç¦»ï¼›å®ƒåªèƒ½çœ‹åˆ°è¯¥æ™ºèƒ½ä½“å¯åŠ¨çš„ä¼šè¯ã€‚
- `process list` åŒ…å«æ´¾ç”Ÿçš„ `name`ï¼ˆå‘½ä»¤åŠ¨è¯ + ç›®æ ‡ï¼‰ä»¥ä¾¿å¿«é€Ÿæµè§ˆã€‚
- `process log` ä½¿ç”¨åŸºäºŽè¡Œçš„ `offset`/`limit`ï¼ˆçœç•¥ `offset` ä»¥èŽ·å–æœ€åŽ N è¡Œï¼‰ã€‚

## ç¤ºä¾‹

è¿è¡Œé•¿æ—¶é—´ä»»åŠ¡å¹¶ç¨åŽè½®è¯¢ï¼š

```json
{ "tool": "exec", "command": "sleep 5 && echo done", "yieldMs": 1000 }
```

```json
{ "tool": "process", "action": "poll", "sessionId": "<id>" }
```

ç«‹å³åœ¨åŽå°å¯åŠ¨ï¼š

```json
{ "tool": "exec", "command": "npm run build", "background": true }
```

å‘é€ stdinï¼š

```json
{ "tool": "process", "action": "write", "sessionId": "<id>", "data": "y\n" }
```

