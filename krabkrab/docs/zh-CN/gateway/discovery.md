---
read_when:
  - å®žçŽ°æˆ–æ›´æ”¹ Bonjour å‘çŽ°/å¹¿æ’­
  - è°ƒæ•´è¿œç¨‹è¿žæŽ¥æ¨¡å¼ï¼ˆç›´è¿ž vs SSHï¼‰
  - è®¾è®¡è¿œç¨‹èŠ‚ç‚¹çš„èŠ‚ç‚¹å‘çŽ° + é…å¯¹
summary: ç”¨äºŽå‘çŽ° Gateway ç½‘å…³çš„èŠ‚ç‚¹å‘çŽ°å’Œä¼ è¾“åè®®ï¼ˆBonjourã€Tailscaleã€SSHï¼‰
title: è®¾å¤‡å‘çŽ° + ä¼ è¾“åè®®
x-i18n:
  generated_at: "2026-02-03T10:06:11Z"
  model: claude-opus-4-5
  provider: pi
  source_hash: e12172c181515bfa6aab8625ed3fbc335b80ba92e2b516c02c6066aeeb9f884c
  source_path: gateway/discovery.md
  workflow: 15
---

# è®¾å¤‡å‘çŽ° & ä¼ è¾“åè®®

KrabKrab æœ‰ä¸¤ä¸ªè¡¨é¢ä¸Šçœ‹èµ·æ¥ç›¸ä¼¼çš„ä¸åŒé—®é¢˜ï¼š

1. **æ“ä½œå‘˜è¿œç¨‹æŽ§åˆ¶**ï¼šmacOS èœå•æ åº”ç”¨æŽ§åˆ¶è¿è¡Œåœ¨å…¶ä»–åœ°æ–¹çš„ Gateway ç½‘å…³ã€‚
2. **èŠ‚ç‚¹é…å¯¹**ï¼šiOS/Androidï¼ˆä»¥åŠæœªæ¥çš„èŠ‚ç‚¹ï¼‰å‘çŽ° Gateway ç½‘å…³å¹¶å®‰å…¨é…å¯¹ã€‚

è®¾è®¡ç›®æ ‡æ˜¯å°†æ‰€æœ‰ç½‘ç»œå‘çŽ°/å¹¿æ’­ä¿ç•™åœ¨ **Node Gateway ç½‘å…³**ï¼ˆ`krabkrab gateway`ï¼‰ä¸­ï¼Œå¹¶è®©å®¢æˆ·ç«¯ï¼ˆmac åº”ç”¨ã€iOSï¼‰ä½œä¸ºæ¶ˆè´¹è€…ã€‚

## æœ¯è¯­

- **Gateway ç½‘å…³**ï¼šä¸€ä¸ªé•¿æœŸè¿è¡Œçš„ Gateway ç½‘å…³è¿›ç¨‹ï¼Œæ‹¥æœ‰çŠ¶æ€ï¼ˆä¼šè¯ã€é…å¯¹ã€èŠ‚ç‚¹æ³¨å†Œè¡¨ï¼‰å¹¶è¿è¡Œæ¸ é“ã€‚å¤§å¤šæ•°è®¾ç½®æ¯å°ä¸»æœºä½¿ç”¨ä¸€ä¸ªï¼›ä¹Ÿå¯ä»¥è¿›è¡Œéš”ç¦»çš„å¤š Gateway ç½‘å…³è®¾ç½®ã€‚
- **Gateway ç½‘å…³ WSï¼ˆæŽ§åˆ¶å¹³é¢ï¼‰**ï¼šé»˜è®¤åœ¨ `127.0.0.1:18789` ä¸Šçš„ WebSocket ç«¯ç‚¹ï¼›å¯é€šè¿‡ `gateway.bind` ç»‘å®šåˆ° LAN/tailnetã€‚
- **ç›´è¿ž WS ä¼ è¾“**ï¼šé¢å‘ LAN/tailnet çš„ Gateway ç½‘å…³ WS ç«¯ç‚¹ï¼ˆæ—  SSHï¼‰ã€‚
- **SSH ä¼ è¾“ï¼ˆå›žé€€ï¼‰**ï¼šé€šè¿‡ SSH è½¬å‘ `127.0.0.1:18789` è¿›è¡Œè¿œç¨‹æŽ§åˆ¶ã€‚
- **æ—§ç‰ˆ TCP æ¡¥æŽ¥ï¼ˆå·²å¼ƒç”¨/ç§»é™¤ï¼‰**ï¼šæ—§çš„èŠ‚ç‚¹ä¼ è¾“ï¼ˆå‚è§ [æ¡¥æŽ¥åè®®](/gateway/bridge-protocol)ï¼‰ï¼›ä¸å†ç”¨äºŽå‘çŽ°å¹¿æ’­ã€‚

åè®®è¯¦æƒ…ï¼š

- [Gateway ç½‘å…³åè®®](/gateway/protocol)
- [æ¡¥æŽ¥åè®®ï¼ˆæ—§ç‰ˆï¼‰](/gateway/bridge-protocol)

## ä¸ºä»€ä¹ˆæˆ‘ä»¬åŒæ—¶ä¿ç•™"ç›´è¿ž"å’Œ SSH

- **ç›´è¿ž WS** åœ¨åŒä¸€ç½‘ç»œå’Œ tailnet å†…æä¾›æœ€ä½³ç”¨æˆ·ä½“éªŒï¼š
  - é€šè¿‡ Bonjour åœ¨ LAN ä¸Šè‡ªåŠ¨å‘çŽ°
  - é…å¯¹ä»¤ç‰Œ + ACL ç”± Gateway ç½‘å…³ç®¡ç†
  - æ— éœ€ shell è®¿é—®ï¼›åè®®è¡¨é¢å¯ä¿æŒç´§å‡‘å’Œå¯å®¡è®¡
- **SSH** ä»ç„¶æ˜¯é€šç”¨å›žé€€æ–¹æ¡ˆï¼š
  - åªè¦ä½ æœ‰ SSH è®¿é—®æƒé™å°±èƒ½å·¥ä½œï¼ˆå³ä½¿è·¨è¶Šä¸ç›¸å…³çš„ç½‘ç»œï¼‰
  - èƒ½åº”å¯¹å¤šæ’­/mDNS é—®é¢˜
  - é™¤ SSH å¤–æ— éœ€æ–°çš„å…¥ç«™ç«¯å£

## å‘çŽ°è¾“å…¥ï¼ˆå®¢æˆ·ç«¯å¦‚ä½•äº†è§£ Gateway ç½‘å…³ä½ç½®ï¼‰

### 1ï¼‰Bonjour / mDNSï¼ˆä»…é™ LANï¼‰

Bonjour æ˜¯å°½åŠ›è€Œä¸ºçš„ï¼Œä¸ä¼šè·¨ç½‘ç»œã€‚å®ƒä»…ç”¨äºŽ"åŒä¸€ LAN"çš„ä¾¿åˆ©æ€§ã€‚

ç›®æ ‡æ–¹å‘ï¼š

- **Gateway ç½‘å…³**é€šè¿‡ Bonjour å¹¿æ’­å…¶ WS ç«¯ç‚¹ã€‚
- å®¢æˆ·ç«¯æµè§ˆå¹¶æ˜¾ç¤º"é€‰æ‹©ä¸€ä¸ª Gateway ç½‘å…³"åˆ—è¡¨ï¼Œç„¶åŽå­˜å‚¨é€‰å®šçš„ç«¯ç‚¹ã€‚

æ•…éšœæŽ’é™¤å’Œä¿¡æ ‡è¯¦æƒ…ï¼š[Bonjour](/gateway/bonjour)ã€‚

#### æœåŠ¡ä¿¡æ ‡è¯¦æƒ…

- æœåŠ¡ç±»åž‹ï¼š
  - `_krabkrab-gw._tcp`ï¼ˆGateway ç½‘å…³ä¼ è¾“ä¿¡æ ‡ï¼‰
- TXT é”®ï¼ˆéžæœºå¯†ï¼‰ï¼š
  - `role=gateway`
  - `lanHost=<hostname>.local`
  - `sshPort=22`ï¼ˆæˆ–å¹¿æ’­çš„ç«¯å£ï¼‰
  - `gatewayPort=18789`ï¼ˆGateway ç½‘å…³ WS + HTTPï¼‰
  - `gatewayTls=1`ï¼ˆä»…å½“å¯ç”¨ TLS æ—¶ï¼‰
  - `gatewayTlsSha256=<sha256>`ï¼ˆä»…å½“å¯ç”¨ TLS ä¸”æŒ‡çº¹å¯ç”¨æ—¶ï¼‰
  - `canvasPort=18793`ï¼ˆé»˜è®¤ç”»å¸ƒä¸»æœºç«¯å£ï¼›æœåŠ¡äºŽ `/__krabkrab__/canvas/`ï¼‰
  - `cliPath=<path>`ï¼ˆå¯é€‰ï¼›å¯è¿è¡Œçš„ `krabkrab` å…¥å£ç‚¹æˆ–äºŒè¿›åˆ¶æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼‰
  - `tailnetDns=<magicdns>`ï¼ˆå¯é€‰æç¤ºï¼›å½“ Tailscale å¯ç”¨æ—¶è‡ªåŠ¨æ£€æµ‹ï¼‰

ç¦ç”¨/è¦†ç›–ï¼š

- `krabkrab_DISABLE_BONJOUR=1` ç¦ç”¨å¹¿æ’­ã€‚
- `~/.krabkrab/krabkrab.json` ä¸­çš„ `gateway.bind` æŽ§åˆ¶ Gateway ç½‘å…³ç»‘å®šæ¨¡å¼ã€‚
- `krabkrab_SSH_PORT` è¦†ç›– TXT ä¸­å¹¿æ’­çš„ SSH ç«¯å£ï¼ˆé»˜è®¤ä¸º 22ï¼‰ã€‚
- `krabkrab_TAILNET_DNS` å‘å¸ƒ `tailnetDns` æç¤ºï¼ˆMagicDNSï¼‰ã€‚
- `krabkrab_CLI_PATH` è¦†ç›–å¹¿æ’­çš„ CLI è·¯å¾„ã€‚

### 2ï¼‰Tailnetï¼ˆè·¨ç½‘ç»œï¼‰

å¯¹äºŽä¼¦æ•¦/ç»´ä¹Ÿçº³é£Žæ ¼çš„è®¾ç½®ï¼ŒBonjour æ— æ³•å¸®åŠ©ã€‚æŽ¨èçš„"ç›´è¿ž"ç›®æ ‡æ˜¯ï¼š

- Tailscale MagicDNS åç§°ï¼ˆé¦–é€‰ï¼‰æˆ–ç¨³å®šçš„ tailnet IPã€‚

å¦‚æžœ Gateway ç½‘å…³èƒ½æ£€æµ‹åˆ°å®ƒæ­£åœ¨ Tailscale ä¸‹è¿è¡Œï¼Œå®ƒä¼šå‘å¸ƒ `tailnetDns` ä½œä¸ºå®¢æˆ·ç«¯çš„å¯é€‰æç¤ºï¼ˆåŒ…æ‹¬å¹¿åŸŸä¿¡æ ‡ï¼‰ã€‚

### 3ï¼‰æ‰‹åŠ¨ / SSH ç›®æ ‡

å½“æ²¡æœ‰ç›´è¿žè·¯ç”±ï¼ˆæˆ–ç›´è¿žè¢«ç¦ç”¨ï¼‰æ—¶ï¼Œå®¢æˆ·ç«¯å§‹ç»ˆå¯ä»¥é€šè¿‡ SSH è½¬å‘æœ¬åœ°å›žçŽ¯ Gateway ç½‘å…³ç«¯å£æ¥è¿žæŽ¥ã€‚

å‚è§ [è¿œç¨‹è®¿é—®](/gateway/remote)ã€‚

## ä¼ è¾“é€‰æ‹©ï¼ˆå®¢æˆ·ç«¯ç­–ç•¥ï¼‰

æŽ¨èçš„å®¢æˆ·ç«¯è¡Œä¸ºï¼š

1. å¦‚æžœå·²é…ç½®ä¸”å¯è¾¾å·²é…å¯¹çš„ç›´è¿žç«¯ç‚¹ï¼Œä½¿ç”¨å®ƒã€‚
2. å¦åˆ™ï¼Œå¦‚æžœ Bonjour åœ¨ LAN ä¸Šæ‰¾åˆ° Gateway ç½‘å…³ï¼Œæä¾›ä¸€é”®"ä½¿ç”¨æ­¤ Gateway ç½‘å…³"é€‰æ‹©å¹¶å°†å…¶ä¿å­˜ä¸ºç›´è¿žç«¯ç‚¹ã€‚
3. å¦åˆ™ï¼Œå¦‚æžœé…ç½®äº† tailnet DNS/IPï¼Œå°è¯•ç›´è¿žã€‚
4. å¦åˆ™ï¼Œå›žé€€åˆ° SSHã€‚

## é…å¯¹ + è®¤è¯ï¼ˆç›´è¿žä¼ è¾“ï¼‰

Gateway ç½‘å…³æ˜¯èŠ‚ç‚¹/å®¢æˆ·ç«¯å‡†å…¥çš„å”¯ä¸€æƒå¨æ¥æºã€‚

- é…å¯¹è¯·æ±‚åœ¨ Gateway ç½‘å…³ä¸­åˆ›å»º/æ‰¹å‡†/æ‹’ç»ï¼ˆå‚è§ [Gateway ç½‘å…³é…å¯¹](/gateway/pairing)ï¼‰ã€‚
- Gateway ç½‘å…³å¼ºåˆ¶æ‰§è¡Œï¼š
  - è®¤è¯ï¼ˆä»¤ç‰Œ / å¯†é’¥å¯¹ï¼‰
  - ä½œç”¨åŸŸ/ACLï¼ˆGateway ç½‘å…³ä¸æ˜¯æ¯ä¸ªæ–¹æ³•çš„åŽŸå§‹ä»£ç†ï¼‰
  - é€ŸçŽ‡é™åˆ¶

## å„ç»„ä»¶èŒè´£

- **Gateway ç½‘å…³**ï¼šå¹¿æ’­å‘çŽ°ä¿¡æ ‡ï¼Œæ‹¥æœ‰é…å¯¹å†³ç­–æƒï¼Œå¹¶æ‰˜ç®¡ WS ç«¯ç‚¹ã€‚
- **macOS åº”ç”¨**ï¼šå¸®åŠ©ä½ é€‰æ‹© Gateway ç½‘å…³ï¼Œæ˜¾ç¤ºé…å¯¹æç¤ºï¼Œä»…å°† SSH ä½œä¸ºå›žé€€æ–¹æ¡ˆã€‚
- **iOS/Android èŠ‚ç‚¹**ï¼šå°† Bonjour æµè§ˆä½œä¸ºä¾¿åˆ©åŠŸèƒ½ï¼Œè¿žæŽ¥åˆ°å·²é…å¯¹çš„ Gateway ç½‘å…³ WSã€‚

