---
read_when:
  - å®žçŽ° macOS åº”ç”¨åŠŸèƒ½
  - åœ¨ macOS ä¸Šæ›´æ”¹ Gateway ç½‘å…³ç”Ÿå‘½å‘¨æœŸæˆ–èŠ‚ç‚¹æ¡¥æŽ¥
summary: KrabKrab macOS é…å¥—åº”ç”¨ï¼ˆèœå•æ  + Gateway ç½‘å…³ä»£ç†ï¼‰
title: macOS åº”ç”¨
x-i18n:
  generated_at: "2026-02-03T07:53:14Z"
  model: claude-opus-4-5
  provider: pi
  source_hash: a5b1c02e5905e4cbc6c0688149cdb50a5bf7653e641947143e169ad948d1f057
  source_path: platforms/macos.md
  workflow: 15
---

# KrabKrab macOS é…å¥—åº”ç”¨ï¼ˆèœå•æ  + Gateway ç½‘å…³ä»£ç†ï¼‰

macOS åº”ç”¨æ˜¯ KrabKrab çš„**èœå•æ é…å¥—åº”ç”¨**ã€‚å®ƒæ‹¥æœ‰æƒé™ï¼Œåœ¨æœ¬åœ°ç®¡ç†/é™„åŠ åˆ° Gateway ç½‘å…³ï¼ˆlaunchd æˆ–æ‰‹åŠ¨ï¼‰ï¼Œå¹¶ä½œä¸ºèŠ‚ç‚¹å‘æ™ºèƒ½ä½“æš´éœ² macOS åŠŸèƒ½ã€‚

## åŠŸèƒ½

- åœ¨èœå•æ ä¸­æ˜¾ç¤ºåŽŸç”Ÿé€šçŸ¥å’ŒçŠ¶æ€ã€‚
- æ‹¥æœ‰ TCC æç¤ºï¼ˆé€šçŸ¥ã€è¾…åŠ©åŠŸèƒ½ã€å±å¹•å½•åˆ¶ã€éº¦å…‹é£Žã€è¯­éŸ³è¯†åˆ«ã€è‡ªåŠ¨åŒ–/AppleScriptï¼‰ã€‚
- è¿è¡Œæˆ–è¿žæŽ¥åˆ° Gateway ç½‘å…³ï¼ˆæœ¬åœ°æˆ–è¿œç¨‹ï¼‰ã€‚
- æš´éœ² macOS ä¸“ç”¨å·¥å…·ï¼ˆCanvasã€ç›¸æœºã€å±å¹•å½•åˆ¶ã€`system.run`ï¼‰ã€‚
- åœ¨**è¿œç¨‹**æ¨¡å¼ä¸‹å¯åŠ¨æœ¬åœ°èŠ‚ç‚¹ä¸»æœºæœåŠ¡ï¼ˆlaunchdï¼‰ï¼Œåœ¨**æœ¬åœ°**æ¨¡å¼ä¸‹åœæ­¢å®ƒã€‚
- å¯é€‰åœ°æ‰˜ç®¡ **PeekabooBridge** ç”¨äºŽ UI è‡ªåŠ¨åŒ–ã€‚
- æ ¹æ®è¯·æ±‚é€šè¿‡ npm/pnpm å®‰è£…å…¨å±€ CLIï¼ˆ`krabkrab`ï¼‰ï¼ˆä¸å»ºè®®ä½¿ç”¨ bun ä½œä¸º Gateway ç½‘å…³è¿è¡Œæ—¶ï¼‰ã€‚

## æœ¬åœ° vs è¿œç¨‹æ¨¡å¼

- **æœ¬åœ°**ï¼ˆé»˜è®¤ï¼‰ï¼šå¦‚æžœå­˜åœ¨è¿è¡Œä¸­çš„æœ¬åœ° Gateway ç½‘å…³ï¼Œåº”ç”¨é™„åŠ åˆ°å®ƒï¼›å¦åˆ™é€šè¿‡ `krabkrab gateway install` å¯ç”¨ launchd æœåŠ¡ã€‚
- **è¿œç¨‹**ï¼šåº”ç”¨é€šè¿‡ SSH/Tailscale è¿žæŽ¥åˆ° Gateway ç½‘å…³ï¼Œä»Žä¸å¯åŠ¨æœ¬åœ°è¿›ç¨‹ã€‚
  åº”ç”¨å¯åŠ¨æœ¬åœ°**èŠ‚ç‚¹ä¸»æœºæœåŠ¡**ï¼Œä»¥ä¾¿è¿œç¨‹ Gateway ç½‘å…³å¯ä»¥è®¿é—®æ­¤ Macã€‚
  åº”ç”¨ä¸ä¼šå°† Gateway ç½‘å…³ä½œä¸ºå­è¿›ç¨‹ç”Ÿæˆã€‚

## Launchd æŽ§åˆ¶

åº”ç”¨ç®¡ç†ä¸€ä¸ªæ ‡è®°ä¸º `bot.molt.gateway` çš„æ¯ç”¨æˆ· LaunchAgentï¼ˆä½¿ç”¨ `--profile`/`krabkrab_PROFILE` æ—¶ä¸º `bot.molt.<profile>`ï¼›æ—§ç‰ˆ `com.krabkrab.*` ä»ä¼šå¸è½½ï¼‰ã€‚

```bash
launchctl kickstart -k gui/$UID/bot.molt.gateway
launchctl bootout gui/$UID/bot.molt.gateway
```

è¿è¡Œå‘½åé…ç½®æ–‡ä»¶æ—¶ï¼Œå°†æ ‡ç­¾æ›¿æ¢ä¸º `bot.molt.<profile>`ã€‚

å¦‚æžœ LaunchAgent æœªå®‰è£…ï¼Œä»Žåº”ç”¨ä¸­å¯ç”¨å®ƒæˆ–è¿è¡Œ `krabkrab gateway install`ã€‚

## èŠ‚ç‚¹åŠŸèƒ½ï¼ˆmacï¼‰

macOS åº”ç”¨å°†è‡ªèº«å‘ˆçŽ°ä¸ºä¸€ä¸ªèŠ‚ç‚¹ã€‚å¸¸ç”¨å‘½ä»¤ï¼š

- Canvasï¼š`canvas.present`ã€`canvas.navigate`ã€`canvas.eval`ã€`canvas.snapshot`ã€`canvas.a2ui.*`
- ç›¸æœºï¼š`camera.snap`ã€`camera.clip`
- å±å¹•ï¼š`screen.record`
- ç³»ç»Ÿï¼š`system.run`ã€`system.notify`

èŠ‚ç‚¹æŠ¥å‘Šä¸€ä¸ª `permissions` æ˜ å°„ï¼Œä»¥ä¾¿æ™ºèƒ½ä½“å¯ä»¥å†³å®šä»€ä¹ˆæ˜¯å…è®¸çš„ã€‚

èŠ‚ç‚¹æœåŠ¡ + åº”ç”¨ IPCï¼š

- å½“æ— å¤´èŠ‚ç‚¹ä¸»æœºæœåŠ¡è¿è¡Œæ—¶ï¼ˆè¿œç¨‹æ¨¡å¼ï¼‰ï¼Œå®ƒä½œä¸ºèŠ‚ç‚¹è¿žæŽ¥åˆ° Gateway ç½‘å…³ WSã€‚
- `system.run` åœ¨ macOS åº”ç”¨ä¸­æ‰§è¡Œï¼ˆUI/TCC ä¸Šä¸‹æ–‡ï¼‰é€šè¿‡æœ¬åœ° Unix å¥—æŽ¥å­—ï¼›æç¤º + è¾“å‡ºä¿ç•™åœ¨åº”ç”¨å†…ã€‚

å›¾ç¤ºï¼ˆSCIï¼‰ï¼š

```
Gateway -> Node Service (WS)
                 |  IPC (UDS + token + HMAC + TTL)
                 v
             Mac App (UI + TCC + system.run)
```

## Exec å®¡æ‰¹ï¼ˆsystem.runï¼‰

`system.run` ç”± macOS åº”ç”¨ä¸­çš„ **Exec å®¡æ‰¹**æŽ§åˆ¶ï¼ˆè®¾ç½® â†’ Exec approvalsï¼‰ã€‚å®‰å…¨ + è¯¢é—® + å…è®¸åˆ—è¡¨æœ¬åœ°å­˜å‚¨åœ¨ Mac ä¸Šï¼š

```
~/.krabkrab/exec-approvals.json
```

ç¤ºä¾‹ï¼š

```json
{
  "version": 1,
  "defaults": {
    "security": "deny",
    "ask": "on-miss"
  },
  "agents": {
    "main": {
      "security": "allowlist",
      "ask": "on-miss",
      "allowlist": [{ "pattern": "/opt/homebrew/bin/rg" }]
    }
  }
}
```

æ³¨æ„äº‹é¡¹ï¼š

- `allowlist` æ¡ç›®æ˜¯è§£æžåŽäºŒè¿›åˆ¶è·¯å¾„çš„ glob æ¨¡å¼ã€‚
- åœ¨æç¤ºä¸­é€‰æ‹©"Always Allow"ä¼šå°†è¯¥å‘½ä»¤æ·»åŠ åˆ°å…è®¸åˆ—è¡¨ã€‚
- `system.run` çŽ¯å¢ƒè¦†ç›–ä¼šè¢«è¿‡æ»¤ï¼ˆåˆ é™¤ `PATH`ã€`DYLD_*`ã€`LD_*`ã€`NODE_OPTIONS`ã€`PYTHON*`ã€`PERL*`ã€`RUBYOPT`ï¼‰ï¼Œç„¶åŽä¸Žåº”ç”¨çš„çŽ¯å¢ƒåˆå¹¶ã€‚

## æ·±åº¦é“¾æŽ¥

åº”ç”¨ä¸ºæœ¬åœ°æ“ä½œæ³¨å†Œ `krabkrab://` URL æ–¹æ¡ˆã€‚

### `krabkrab://agent`

è§¦å‘ Gateway ç½‘å…³ `agent` è¯·æ±‚ã€‚

```bash
open 'krabkrab://agent?message=Hello%20from%20deep%20link'
```

æŸ¥è¯¢å‚æ•°ï¼š

- `message`ï¼ˆå¿…éœ€ï¼‰
- `sessionKey`ï¼ˆå¯é€‰ï¼‰
- `thinking`ï¼ˆå¯é€‰ï¼‰
- `deliver` / `to` / `channel`ï¼ˆå¯é€‰ï¼‰
- `timeoutSeconds`ï¼ˆå¯é€‰ï¼‰
- `key`ï¼ˆå¯é€‰æ— äººå€¼å®ˆæ¨¡å¼å¯†é’¥ï¼‰

å®‰å…¨ï¼š

- æ²¡æœ‰ `key` æ—¶ï¼Œåº”ç”¨ä¼šæç¤ºç¡®è®¤ã€‚
- æœ‰æœ‰æ•ˆçš„ `key` æ—¶ï¼Œè¿è¡Œæ˜¯æ— äººå€¼å®ˆçš„ï¼ˆç”¨äºŽä¸ªäººè‡ªåŠ¨åŒ–ï¼‰ã€‚

## æ–°æ‰‹å¼•å¯¼æµç¨‹ï¼ˆå…¸åž‹ï¼‰

1. å®‰è£…å¹¶å¯åŠ¨ **KrabKrab.app**ã€‚
2. å®Œæˆæƒé™æ¸…å•ï¼ˆTCC æç¤ºï¼‰ã€‚
3. ç¡®ä¿**æœ¬åœ°**æ¨¡å¼å¤„äºŽæ´»åŠ¨çŠ¶æ€ä¸” Gateway ç½‘å…³æ­£åœ¨è¿è¡Œã€‚
4. å¦‚æžœä½ æƒ³è¦ç»ˆç«¯è®¿é—®ï¼Œå®‰è£… CLIã€‚

## æž„å»ºå’Œå¼€å‘å·¥ä½œæµç¨‹ï¼ˆåŽŸç”Ÿï¼‰

- `cd apps/macos && swift build`
- `swift run KrabKrab`ï¼ˆæˆ– Xcodeï¼‰
- æ‰“åŒ…åº”ç”¨ï¼š`scripts/package-mac-app.sh`

## è°ƒè¯• Gateway ç½‘å…³è¿žæŽ¥ï¼ˆmacOS CLIï¼‰

ä½¿ç”¨è°ƒè¯• CLI æ¥æ‰§è¡Œä¸Ž macOS åº”ç”¨ä½¿ç”¨çš„ç›¸åŒçš„ Gateway ç½‘å…³ WebSocket æ¡æ‰‹å’Œå‘çŽ°é€»è¾‘ï¼Œè€Œæ— éœ€å¯åŠ¨åº”ç”¨ã€‚

```bash
cd apps/macos
swift run krabkrab-mac connect --json
swift run krabkrab-mac discover --timeout 3000 --json
```

Connect é€‰é¡¹ï¼š

- `--url <ws://host:port>`ï¼šè¦†ç›–é…ç½®
- `--mode <local|remote>`ï¼šä»Žé…ç½®è§£æžï¼ˆé»˜è®¤ï¼šé…ç½®æˆ– localï¼‰
- `--probe`ï¼šå¼ºåˆ¶è¿›è¡Œæ–°çš„å¥åº·æŽ¢æµ‹
- `--timeout <ms>`ï¼šè¯·æ±‚è¶…æ—¶ï¼ˆé»˜è®¤ï¼š`15000`ï¼‰
- `--json`ï¼šç”¨äºŽæ¯”è¾ƒçš„ç»“æž„åŒ–è¾“å‡º

Discovery é€‰é¡¹ï¼š

- `--include-local`ï¼šåŒ…å«ä¼šè¢«è¿‡æ»¤ä¸º"æœ¬åœ°"çš„ Gateway ç½‘å…³
- `--timeout <ms>`ï¼šæ€»ä½“å‘çŽ°çª—å£ï¼ˆé»˜è®¤ï¼š`2000`ï¼‰
- `--json`ï¼šç”¨äºŽæ¯”è¾ƒçš„ç»“æž„åŒ–è¾“å‡º

æç¤ºï¼šä¸Ž `krabkrab gateway discover --json` æ¯”è¾ƒï¼ŒæŸ¥çœ‹ macOS åº”ç”¨çš„å‘çŽ°ç®¡é“ï¼ˆNWBrowser + tailnet DNS-SD å›žé€€ï¼‰æ˜¯å¦ä¸Ž Node CLI åŸºäºŽ `dns-sd` çš„å‘çŽ°ä¸åŒã€‚

## è¿œç¨‹è¿žæŽ¥ç®¡é“ï¼ˆSSH éš§é“ï¼‰

å½“ macOS åº”ç”¨åœ¨**è¿œç¨‹**æ¨¡å¼ä¸‹è¿è¡Œæ—¶ï¼Œå®ƒä¼šæ‰“å¼€ä¸€ä¸ª SSH éš§é“ï¼Œä»¥ä¾¿æœ¬åœ° UI ç»„ä»¶å¯ä»¥åƒåœ¨ localhost ä¸Šä¸€æ ·ä¸Žè¿œç¨‹ Gateway ç½‘å…³é€šä¿¡ã€‚

### æŽ§åˆ¶éš§é“ï¼ˆGateway ç½‘å…³ WebSocket ç«¯å£ï¼‰

- **ç›®çš„ï¼š**å¥åº·æ£€æŸ¥ã€çŠ¶æ€ã€Web Chatã€é…ç½®å’Œå…¶ä»–æŽ§åˆ¶å¹³é¢è°ƒç”¨ã€‚
- **æœ¬åœ°ç«¯å£ï¼š**Gateway ç½‘å…³ç«¯å£ï¼ˆé»˜è®¤ `18789`ï¼‰ï¼Œå§‹ç»ˆç¨³å®šã€‚
- **è¿œç¨‹ç«¯å£ï¼š**è¿œç¨‹ä¸»æœºä¸Šçš„ç›¸åŒ Gateway ç½‘å…³ç«¯å£ã€‚
- **è¡Œä¸ºï¼š**æ— éšæœºæœ¬åœ°ç«¯å£ï¼›åº”ç”¨å¤ç”¨çŽ°æœ‰çš„å¥åº·éš§é“æˆ–åœ¨éœ€è¦æ—¶é‡å¯å®ƒã€‚
- **SSH å½¢å¼ï¼š**`ssh -N -L <local>:127.0.0.1:<remote>`ï¼Œå¸¦æœ‰ BatchMode + ExitOnForwardFailure + keepalive é€‰é¡¹ã€‚
- **IP æŠ¥å‘Šï¼š**SSH éš§é“ä½¿ç”¨ loopbackï¼Œå› æ­¤ Gateway ç½‘å…³å°†çœ‹åˆ°èŠ‚ç‚¹ IP ä¸º `127.0.0.1`ã€‚å¦‚æžœä½ æƒ³è¦æ˜¾ç¤ºçœŸå®žçš„å®¢æˆ·ç«¯ IPï¼Œè¯·ä½¿ç”¨ **Direct (ws/wss)** ä¼ è¾“ï¼ˆå‚è§ [macOS è¿œç¨‹è®¿é—®](/platforms/mac/remote)ï¼‰ã€‚

æœ‰å…³è®¾ç½®æ­¥éª¤ï¼Œè¯·å‚é˜… [macOS è¿œç¨‹è®¿é—®](/platforms/mac/remote)ã€‚æœ‰å…³åè®®è¯¦æƒ…ï¼Œè¯·å‚é˜… [Gateway ç½‘å…³åè®®](/gateway/protocol)ã€‚

## ç›¸å…³æ–‡æ¡£

- [Gateway ç½‘å…³è¿ç»´æ‰‹å†Œ](/gateway)
- [Gateway ç½‘å…³ï¼ˆmacOSï¼‰](/platforms/mac/bundled-gateway)
- [macOS æƒé™](/platforms/mac/permissions)
- [Canvas](/platforms/mac/canvas)

