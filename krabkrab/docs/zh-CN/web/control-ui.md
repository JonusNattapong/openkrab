---
read_when:
  - ä½ æƒ³ä»Žæµè§ˆå™¨æ“ä½œ Gateway ç½‘å…³
  - ä½ æƒ³è¦æ— éœ€ SSH éš§é“çš„ Tailnet è®¿é—®
summary: Gateway ç½‘å…³çš„æµè§ˆå™¨æŽ§åˆ¶ UIï¼ˆèŠå¤©ã€èŠ‚ç‚¹ã€é…ç½®ï¼‰
title: æŽ§åˆ¶ UI
x-i18n:
  generated_at: "2026-02-03T10:13:20Z"
  model: claude-opus-4-5
  provider: pi
  source_hash: bef105a376fc1a1df44e3e4fb625db1cbcafe2f41e718181c36877b8cbc08816
  source_path: web/control-ui.md
  workflow: 15
---

# æŽ§åˆ¶ UIï¼ˆæµè§ˆå™¨ï¼‰

æŽ§åˆ¶ UI æ˜¯ä¸€ä¸ªç”± Gateway ç½‘å…³æä¾›æœåŠ¡çš„å°åž‹ **Vite + Lit** å•é¡µåº”ç”¨ï¼š

- é»˜è®¤ï¼š`http://<host>:18789/`
- å¯é€‰å‰ç¼€ï¼šè®¾ç½® `gateway.controlUi.basePath`ï¼ˆä¾‹å¦‚ `/krabkrab`ï¼‰

å®ƒ**ç›´æŽ¥ä¸ŽåŒä¸€ç«¯å£ä¸Šçš„ Gateway ç½‘å…³ WebSocket** é€šä¿¡ã€‚

## å¿«é€Ÿæ‰“å¼€ï¼ˆæœ¬åœ°ï¼‰

å¦‚æžœ Gateway ç½‘å…³åœ¨åŒä¸€å°è®¡ç®—æœºä¸Šè¿è¡Œï¼Œæ‰“å¼€ï¼š

- http://127.0.0.1:18789/ï¼ˆæˆ– http://localhost:18789/ï¼‰

å¦‚æžœé¡µé¢åŠ è½½å¤±è´¥ï¼Œè¯·å…ˆå¯åŠ¨ Gateway ç½‘å…³ï¼š`krabkrab gateway`ã€‚

è®¤è¯åœ¨ WebSocket æ¡æ‰‹æœŸé—´é€šè¿‡ä»¥ä¸‹æ–¹å¼æä¾›ï¼š

- `connect.params.auth.token`
- `connect.params.auth.password`
  ä»ªè¡¨æ¿è®¾ç½®é¢æ¿å…è®¸ä½ å­˜å‚¨ tokenï¼›å¯†ç ä¸ä¼šè¢«æŒä¹…åŒ–ã€‚
  æ–°æ‰‹å¼•å¯¼å‘å¯¼é»˜è®¤ç”Ÿæˆä¸€ä¸ª Gateway ç½‘å…³ tokenï¼Œæ‰€ä»¥åœ¨é¦–æ¬¡è¿žæŽ¥æ—¶å°†å…¶ç²˜è´´åˆ°è¿™é‡Œã€‚

## è®¾å¤‡é…å¯¹ï¼ˆé¦–æ¬¡è¿žæŽ¥ï¼‰

å½“ä½ ä»Žæ–°æµè§ˆå™¨æˆ–è®¾å¤‡è¿žæŽ¥åˆ°æŽ§åˆ¶ UI æ—¶ï¼ŒGateway ç½‘å…³éœ€è¦**ä¸€æ¬¡æ€§é…å¯¹æ‰¹å‡†** â€” å³ä½¿ä½ åœ¨åŒä¸€ä¸ª Tailnet ä¸Šä¸” `gateway.auth.allowTailscale: true`ã€‚è¿™æ˜¯é˜²æ­¢æœªæŽˆæƒè®¿é—®çš„å®‰å…¨æŽªæ–½ã€‚

**ä½ ä¼šçœ‹åˆ°ï¼š** "disconnected (1008): pairing required"

**æ‰¹å‡†è®¾å¤‡ï¼š**

```bash
# åˆ—å‡ºå¾…å¤„ç†çš„è¯·æ±‚
krabkrab devices list

# æŒ‰è¯·æ±‚ ID æ‰¹å‡†
krabkrab devices approve <requestId>
```

ä¸€æ—¦æ‰¹å‡†ï¼Œè®¾å¤‡ä¼šè¢«è®°ä½ï¼Œé™¤éžä½ ä½¿ç”¨ `krabkrab devices revoke --device <id> --role <role>` æ’¤é”€å®ƒï¼Œå¦åˆ™ä¸éœ€è¦é‡æ–°æ‰¹å‡†ã€‚å‚è§ [Devices CLI](/cli/devices) äº†è§£ token è½®æ¢å’Œæ’¤é”€ã€‚

**æ³¨æ„ï¼š**

- æœ¬åœ°è¿žæŽ¥ï¼ˆ`127.0.0.1`ï¼‰ä¼šè‡ªåŠ¨æ‰¹å‡†ã€‚
- è¿œç¨‹è¿žæŽ¥ï¼ˆLANã€Tailnet ç­‰ï¼‰éœ€è¦æ˜¾å¼æ‰¹å‡†ã€‚
- æ¯ä¸ªæµè§ˆå™¨é…ç½®æ–‡ä»¶ç”Ÿæˆå”¯ä¸€çš„è®¾å¤‡ IDï¼Œå› æ­¤åˆ‡æ¢æµè§ˆå™¨æˆ–æ¸…é™¤æµè§ˆå™¨æ•°æ®å°†éœ€è¦é‡æ–°é…å¯¹ã€‚

## ç›®å‰å¯ä»¥åšä»€ä¹ˆ

- é€šè¿‡ Gateway ç½‘å…³ WS ä¸Žæ¨¡åž‹èŠå¤©ï¼ˆ`chat.history`ã€`chat.send`ã€`chat.abort`ã€`chat.inject`ï¼‰
- åœ¨èŠå¤©ä¸­æµå¼ä¼ è¾“å·¥å…·è°ƒç”¨ + å®žæ—¶å·¥å…·è¾“å‡ºå¡ç‰‡ï¼ˆæ™ºèƒ½ä½“äº‹ä»¶ï¼‰
- æ¸ é“ï¼šWhatsApp/Telegram/Discord/Slack + æ’ä»¶æ¸ é“ï¼ˆMattermost ç­‰ï¼‰çŠ¶æ€ + QR ç™»å½• + æ¯æ¸ é“é…ç½®ï¼ˆ`channels.status`ã€`web.login.*`ã€`config.patch`ï¼‰
- å®žä¾‹ï¼šåœ¨çº¿åˆ—è¡¨ + åˆ·æ–°ï¼ˆ`system-presence`ï¼‰
- ä¼šè¯ï¼šåˆ—è¡¨ + æ¯ä¼šè¯æ€è€ƒ/è¯¦ç»†è¦†ç›–ï¼ˆ`sessions.list`ã€`sessions.patch`ï¼‰
- å®šæ—¶ä»»åŠ¡ï¼šåˆ—å‡º/æ·»åŠ /è¿è¡Œ/å¯ç”¨/ç¦ç”¨ + è¿è¡ŒåŽ†å²ï¼ˆ`cron.*`ï¼‰
- Skillsï¼šçŠ¶æ€ã€å¯ç”¨/ç¦ç”¨ã€å®‰è£…ã€API å¯†é’¥æ›´æ–°ï¼ˆ`skills.*`ï¼‰
- èŠ‚ç‚¹ï¼šåˆ—è¡¨ + èƒ½åŠ›ï¼ˆ`node.list`ï¼‰
- æ‰§è¡Œæ‰¹å‡†ï¼šç¼–è¾‘ Gateway ç½‘å…³æˆ–èŠ‚ç‚¹å…è®¸åˆ—è¡¨ + `exec host=gateway/node` çš„è¯¢é—®ç­–ç•¥ï¼ˆ`exec.approvals.*`ï¼‰
- é…ç½®ï¼šæŸ¥çœ‹/ç¼–è¾‘ `~/.krabkrab/krabkrab.json`ï¼ˆ`config.get`ã€`config.set`ï¼‰
- é…ç½®ï¼šåº”ç”¨ + å¸¦éªŒè¯çš„é‡å¯ï¼ˆ`config.apply`ï¼‰å¹¶å”¤é†’ä¸Šæ¬¡æ´»åŠ¨çš„ä¼šè¯
- é…ç½®å†™å…¥åŒ…å«åŸºç¡€å“ˆå¸Œä¿æŠ¤ï¼Œä»¥é˜²æ­¢è¦†ç›–å¹¶å‘ç¼–è¾‘
- é…ç½® schema + è¡¨å•æ¸²æŸ“ï¼ˆ`config.schema`ï¼ŒåŒ…æ‹¬æ’ä»¶ + æ¸ é“ schemaï¼‰ï¼›åŽŸå§‹ JSON ç¼–è¾‘å™¨ä»ç„¶å¯ç”¨
- è°ƒè¯•ï¼šçŠ¶æ€/å¥åº·/æ¨¡åž‹å¿«ç…§ + äº‹ä»¶æ—¥å¿— + æ‰‹åŠ¨ RPC è°ƒç”¨ï¼ˆ`status`ã€`health`ã€`models.list`ï¼‰
- æ—¥å¿—ï¼šGateway ç½‘å…³æ–‡ä»¶æ—¥å¿—çš„å®žæ—¶å°¾éƒ¨è·Ÿè¸ªï¼Œå¸¦è¿‡æ»¤/å¯¼å‡ºï¼ˆ`logs.tail`ï¼‰
- æ›´æ–°ï¼šè¿è¡ŒåŒ…/git æ›´æ–° + é‡å¯ï¼ˆ`update.run`ï¼‰å¹¶æ˜¾ç¤ºé‡å¯æŠ¥å‘Š

## èŠå¤©è¡Œä¸º

- `chat.send` æ˜¯**éžé˜»å¡žçš„**ï¼šå®ƒç«‹å³ä»¥ `{ runId, status: "started" }` ç¡®è®¤ï¼Œå“åº”é€šè¿‡ `chat` äº‹ä»¶æµå¼ä¼ è¾“ã€‚
- ä½¿ç”¨ç›¸åŒçš„ `idempotencyKey` é‡æ–°å‘é€åœ¨è¿è¡Œæ—¶è¿”å›ž `{ status: "in_flight" }`ï¼Œå®ŒæˆåŽè¿”å›ž `{ status: "ok" }`ã€‚
- `chat.inject` å°†åŠ©æ‰‹å¤‡æ³¨é™„åŠ åˆ°ä¼šè¯è½¬å½•ï¼Œå¹¶ä¸ºä»… UI æ›´æ–°å¹¿æ’­ `chat` äº‹ä»¶ï¼ˆæ— æ™ºèƒ½ä½“è¿è¡Œï¼Œæ— æ¸ é“æŠ•é€’ï¼‰ã€‚
- åœæ­¢ï¼š
  - ç‚¹å‡»**åœæ­¢**ï¼ˆè°ƒç”¨ `chat.abort`ï¼‰
  - è¾“å…¥ `/stop`ï¼ˆæˆ– `stop|esc|abort|wait|exit|interrupt`ï¼‰ä»¥å¸¦å¤–ä¸­æ­¢
  - `chat.abort` æ”¯æŒ `{ sessionKey }`ï¼ˆæ—  `runId`ï¼‰ä»¥ä¸­æ­¢è¯¥ä¼šè¯çš„æ‰€æœ‰æ´»åŠ¨è¿è¡Œ

## Tailnet è®¿é—®ï¼ˆæŽ¨èï¼‰

### é›†æˆ Tailscale Serveï¼ˆé¦–é€‰ï¼‰

ä¿æŒ Gateway ç½‘å…³åœ¨ loopback ä¸Šï¼Œè®© Tailscale Serve ç”¨ HTTPS ä»£ç†å®ƒï¼š

```bash
krabkrab gateway --tailscale serve
```

æ‰“å¼€ï¼š

- `https://<magicdns>/`ï¼ˆæˆ–ä½ é…ç½®çš„ `gateway.controlUi.basePath`ï¼‰

é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ `gateway.auth.allowTailscale` ä¸º `true` æ—¶ï¼ŒServe è¯·æ±‚å¯ä»¥é€šè¿‡ Tailscale èº«ä»½å¤´ï¼ˆ`tailscale-user-login`ï¼‰è¿›è¡Œè®¤è¯ã€‚KrabKrab é€šè¿‡ä½¿ç”¨ `tailscale whois` è§£æž `x-forwarded-for` åœ°å€å¹¶ä¸Žå¤´åŒ¹é…æ¥éªŒè¯èº«ä»½ï¼Œå¹¶ä¸”åªåœ¨è¯·æ±‚é€šè¿‡ Tailscale çš„ `x-forwarded-*` å¤´åˆ°è¾¾ loopback æ—¶æŽ¥å—è¿™äº›ã€‚å¦‚æžœä½ æƒ³å³ä½¿å¯¹äºŽ Serve æµé‡ä¹Ÿè¦æ±‚ token/å¯†ç ï¼Œè¯·è®¾ç½® `gateway.auth.allowTailscale: false`ï¼ˆæˆ–å¼ºåˆ¶ `gateway.auth.mode: "password"`ï¼‰ã€‚

### ç»‘å®šåˆ° tailnet + token

```bash
krabkrab gateway --bind tailnet --token "$(openssl rand -hex 32)"
```

ç„¶åŽæ‰“å¼€ï¼š

- `http://<tailscale-ip>:18789/`ï¼ˆæˆ–ä½ é…ç½®çš„ `gateway.controlUi.basePath`ï¼‰

å°† token ç²˜è´´åˆ° UI è®¾ç½®ä¸­ï¼ˆä½œä¸º `connect.params.auth.token` å‘é€ï¼‰ã€‚

## ä¸å®‰å…¨çš„ HTTP

å¦‚æžœä½ é€šè¿‡æ™®é€š HTTP æ‰“å¼€ä»ªè¡¨æ¿ï¼ˆ`http://<lan-ip>` æˆ– `http://<tailscale-ip>`ï¼‰ï¼Œæµè§ˆå™¨åœ¨**éžå®‰å…¨ä¸Šä¸‹æ–‡**ä¸­è¿è¡Œå¹¶é˜»æ­¢ WebCryptoã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒKrabKrab **é˜»æ­¢**æ²¡æœ‰è®¾å¤‡èº«ä»½çš„æŽ§åˆ¶ UI è¿žæŽ¥ã€‚

**æŽ¨èä¿®å¤ï¼š** ä½¿ç”¨ HTTPSï¼ˆTailscale Serveï¼‰æˆ–åœ¨æœ¬åœ°æ‰“å¼€ UIï¼š

- `https://<magicdns>/`ï¼ˆServeï¼‰
- `http://127.0.0.1:18789/`ï¼ˆåœ¨ Gateway ç½‘å…³ä¸»æœºä¸Šï¼‰

**é™çº§ç¤ºä¾‹ï¼ˆä»…é€šè¿‡ HTTP ä½¿ç”¨ tokenï¼‰ï¼š**

```json5
{
  gateway: {
    controlUi: { allowInsecureAuth: true },
    bind: "tailnet",
    auth: { mode: "token", token: "replace-me" },
  },
}
```

è¿™ä¼šä¸ºæŽ§åˆ¶ UI ç¦ç”¨è®¾å¤‡èº«ä»½ + é…å¯¹ï¼ˆå³ä½¿åœ¨ HTTPS ä¸Šï¼‰ã€‚ä»…åœ¨ä½ ä¿¡ä»»ç½‘ç»œæ—¶ä½¿ç”¨ã€‚

å‚è§ [Tailscale](/gateway/tailscale) äº†è§£ HTTPS è®¾ç½®æŒ‡å—ã€‚

## æž„å»º UI

Gateway ç½‘å…³ä»Ž `dist/control-ui` æä¾›é™æ€æ–‡ä»¶ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æž„å»ºï¼š

```bash
pnpm ui:build # é¦–æ¬¡è¿è¡Œæ—¶è‡ªåŠ¨å®‰è£… UI ä¾èµ–
```

å¯é€‰çš„ç»å¯¹åŸºç¡€è·¯å¾„ï¼ˆå½“ä½ æƒ³è¦å›ºå®šçš„èµ„æº URL æ—¶ï¼‰ï¼š

```bash
krabkrab_CONTROL_UI_BASE_PATH=/krabkrab/ pnpm ui:build
```

ç”¨äºŽæœ¬åœ°å¼€å‘ï¼ˆå•ç‹¬çš„å¼€å‘æœåŠ¡å™¨ï¼‰ï¼š

```bash
pnpm ui:dev # é¦–æ¬¡è¿è¡Œæ—¶è‡ªåŠ¨å®‰è£… UI ä¾èµ–
```

ç„¶åŽå°† UI æŒ‡å‘ä½ çš„ Gateway ç½‘å…³ WS URLï¼ˆä¾‹å¦‚ `ws://127.0.0.1:18789`ï¼‰ã€‚

## è°ƒè¯•/æµ‹è¯•ï¼šå¼€å‘æœåŠ¡å™¨ + è¿œç¨‹ Gateway ç½‘å…³

æŽ§åˆ¶ UI æ˜¯é™æ€æ–‡ä»¶ï¼›WebSocket ç›®æ ‡æ˜¯å¯é…ç½®çš„ï¼Œå¯ä»¥ä¸Ž HTTP æºä¸åŒã€‚å½“ä½ æƒ³è¦åœ¨æœ¬åœ°ä½¿ç”¨ Vite å¼€å‘æœåŠ¡å™¨ä½† Gateway ç½‘å…³åœ¨å…¶ä»–åœ°æ–¹è¿è¡Œæ—¶ï¼Œè¿™å¾ˆæ–¹ä¾¿ã€‚

1. å¯åŠ¨ UI å¼€å‘æœåŠ¡å™¨ï¼š`pnpm ui:dev`
2. æ‰“å¼€ç±»ä¼¼ä»¥ä¸‹çš„ URLï¼š

```text
http://localhost:5173/?gatewayUrl=ws://<gateway-host>:18789
```

å¯é€‰çš„ä¸€æ¬¡æ€§è®¤è¯ï¼ˆå¦‚éœ€è¦ï¼‰ï¼š

```text
http://localhost:5173/?gatewayUrl=wss://<gateway-host>:18789&token=<gateway-token>
```

æ³¨æ„ï¼š

- `gatewayUrl` åœ¨åŠ è½½åŽå­˜å‚¨åœ¨ localStorage ä¸­å¹¶ä»Ž URL ä¸­ç§»é™¤ã€‚
- `token` å­˜å‚¨åœ¨ localStorage ä¸­ï¼›`password` ä»…ä¿ç•™åœ¨å†…å­˜ä¸­ã€‚
- å½“ Gateway ç½‘å…³åœ¨ TLS åŽé¢æ—¶ï¼ˆTailscale Serveã€HTTPS ä»£ç†ç­‰ï¼‰ï¼Œä½¿ç”¨ `wss://`ã€‚

è¿œç¨‹è®¿é—®è®¾ç½®è¯¦æƒ…ï¼š[è¿œç¨‹è®¿é—®](/gateway/remote)ã€‚

